# ğŸš€ é‡åŒ–-AIæ·±åº¦è”åŠ¨åˆ†æç³»ç»Ÿ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

åŸºäº **vnpy æ¶æ„**çš„å¤šæ™ºèƒ½ä½“é‡åŒ–äº¤æ˜“åˆ†æç³»ç»Ÿï¼Œå®ç°é‡åŒ–ç¡¬æ•°æ®ä¸ AI è½¯åˆ¤æ–­çš„æ·±åº¦èåˆã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ï¼ˆåŸºäº vnpy Master åˆ†æ”¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QuantEventEngine (äº‹ä»¶å¼•æ“)                â”‚
â”‚                    å‚è€ƒ: vnpy.event.EventEngine              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quant Agent   â”‚    â”‚  Market Info Agent â”‚
â”‚  (é‡åŒ–æ‰§è¡Œå®˜)   â”‚    â”‚  (å¸‚åœºæƒ…æŠ¥å®˜)       â”‚
â”‚                â”‚    â”‚                    â”‚
â”‚ Â· ArrayManager â”‚    â”‚ Â· æƒ…ç»ªåˆ†æ          â”‚
â”‚ Â· æŠ€æœ¯æŒ‡æ ‡è®¡ç®—  â”‚    â”‚ Â· å¸‚åœºçŠ¶æ€åˆ¤æ–­      â”‚
â”‚ Â· ä¿¡å·ç”Ÿæˆ      â”‚    â”‚ Â· æ³¢åŠ¨ç‡é¢„æµ‹        â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  FusionAnalysisEngine     â”‚
    â”‚  (èåˆåˆ†æå¼•æ“)            â”‚
    â”‚                           â”‚
    â”‚  Â· äº¤å‰éªŒè¯                â”‚
    â”‚  Â· åŠ¨æ€å‚æ•°è°ƒæ•´            â”‚
    â”‚  Â· ç›˜åå¾®æ³¢åŠ¨å¤„ç†          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– Agent è§’è‰²å®šä¹‰

### 1ï¸âƒ£ Quant Agent (é‡åŒ–æ‰§è¡Œå®˜)

**å‚è€ƒ**: `vnpy.app.cta_strategy.StrategyTemplate`

**èŒè´£**ï¼š
- å¤„ç† OHLCV æ•°æ®
- åˆ©ç”¨ `ArrayManager` è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆMA, RSI, MACD, KDJ, Bollinger, ATRï¼‰
- åŸºäºç¡¬æ•°æ®ç”Ÿæˆå¤šç©ºä¿¡å·å’Œä»“ä½å»ºè®®

**è¾“å‡º**ï¼š
```python
{
    "score": 65.3,           # é‡åŒ–è¯„åˆ† 0-100
    "pos": 1,                # ä»“ä½ï¼š1å¤šå¤´ï¼Œ0ç©ºä»“ï¼Œ-1ç©ºå¤´
    "bullish_signals": 8,    # å¤šå¤´ä¿¡å·æ•°
    "bearish_signals": 3,    # ç©ºå¤´ä¿¡å·æ•°
    "signals": [             # å…·ä½“ä¿¡å·
        "å‡çº¿å¤šå¤´æ’åˆ—",
        "MACDé‡‘å‰",
        "RSIè¶…å–"
    ]
}
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `on_bar()`: Kçº¿å›è°ƒï¼ˆå‚è€ƒ vnpyï¼‰
- `calculate_signals()`: è®¡ç®—é‡åŒ–ä¿¡å·
- `_check_ma_system()`: å‡çº¿ç³»ç»Ÿæ£€æŸ¥
- `_check_macd()`: MACD æŒ‡æ ‡æ£€æŸ¥
- `_check_rsi()`: RSI æŒ‡æ ‡æ£€æŸ¥

---

### 2ï¸âƒ£ Market Info Agent (å¸‚åœºæƒ…æŠ¥å®˜)

**èŒè´£**ï¼š
- æ¨¡æ‹Ÿ AI å¯¹éç»“æ„åŒ–æ•°æ®çš„æ„ŸçŸ¥ï¼ˆæ–°é—»ã€å®è§‚æƒ…ç»ªï¼‰
- æ•æ‰ç›˜åå¾®å¼±æ³¢åŠ¨èƒŒåçš„æ½œåœ¨æƒ…ç»ª
- åˆ†æå¸‚åœºçŠ¶æ€å’Œæ³¢åŠ¨ç‡

**è¾“å‡º**ï¼š
```python
{
    "sentiment_score": 72.5,       # æƒ…ç»ªè¯„åˆ† 0-100
    "market_regime": "trending",   # å¸‚åœºçŠ¶æ€
    "volatility_forecast": "low",  # æ³¢åŠ¨ç‡é¢„æµ‹
    "confidence": "high"           # ç½®ä¿¡åº¦
}
```

**åˆ†æç»´åº¦**ï¼š
1. **ä»·æ ¼åŠ¨é‡æƒ…ç»ª** (35% æƒé‡)
2. **æˆäº¤é‡æƒ…ç»ª** (25% æƒé‡)
3. **æ³¢åŠ¨ç‡æƒ…ç»ª** (20% æƒé‡)
4. **è¶‹åŠ¿å¼ºåº¦** (20% æƒé‡)

---

## ğŸ”— æ·±åº¦è”åŠ¨åˆ†æé€»è¾‘

### äº¤å‰éªŒè¯æœºåˆ¶

```python
# ä¼ªä»£ç ç¤ºä¾‹
if quant_signal == "buy" and sentiment_score > 60:
    # âœ… ä¿¡å·ä¸€è‡´ â†’ æå‡ç½®ä¿¡åº¦
    fusion_score = quant_score * 0.6 + sentiment_score * 0.4 + 10
    confidence = "high"
    
elif quant_signal == "buy" and sentiment_score < 40:
    # âš ï¸ ä¿¡å·çŸ›ç›¾ â†’ é™ä½ç½®ä¿¡åº¦
    fusion_score = quant_score * 0.5 + sentiment_score * 0.5 - 15
    confidence = "low"
    recommendation = "è§‚æœ›ï¼Œç­‰å¾…æ›´å¤šç¡®è®¤ä¿¡å·"
```

### åŠ¨æ€å‚æ•°è°ƒæ•´

æ ¹æ®æƒ…ç»ªè¯„åˆ†åŠ¨æ€è°ƒæ•´ç­–ç•¥å‚æ•°ï¼š

| æƒ…ç»ªåˆ†æ•° | æ­¢æŸè°ƒæ•´ | å¼€ä»“é˜ˆå€¼ | ä»“ä½è°ƒæ•´ |
|---------|---------|---------|---------|
| < 40 (æ‚²è§‚) | -20% | +10åˆ† | -40% |
| 40-70 (ä¸­æ€§) | 0% | 0 | -20% |
| > 70 (ä¹è§‚) | +20% | -5åˆ† | 0% |

---

## ğŸŒ™ ç›˜åå¾®æ³¢åŠ¨å¤„ç†

### æ£€æµ‹é€»è¾‘

å‚è€ƒ vnpy çš„ Tick æ•°æ®å¤„ç†ï¼Œåˆ†æç›˜åå¾®å°æ³¢åŠ¨æ˜¯å¦å…·æœ‰ç»Ÿè®¡å­¦æ„ä¹‰ï¼š

```python
# æ³¢åŠ¨ç‡æ¯”ç‡ = ç›˜åæ³¢åŠ¨ / å†å²æ³¢åŠ¨
if volatility_ratio > 2.0:
    åˆ¤å®šä¸º: "abnormal_volatility" (å¼‚å¸¸æ³¢åŠ¨)
    å»ºè®®: "éœ€å…³æ³¨çªå‘æ¶ˆæ¯ï¼Œè€ƒè™‘è®¾ç½®é¢„è­¦"
    
elif abs(mean_change) > 2 * historical_std:
    åˆ¤å®šä¸º: "directional_move" (æ–¹å‘æ€§ç§»åŠ¨)
    å»ºè®®: "æ¬¡æ—¥å¼€ç›˜å¯†åˆ‡å…³æ³¨"
    
else:
    åˆ¤å®šä¸º: "noise" (å™ªéŸ³)
    å»ºè®®: "ç›˜åå¾®å¼±æ³¢åŠ¨ï¼Œç»Ÿè®¡å­¦ä¸æ˜¾è‘—ï¼Œè§‚æœ›"
```

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### Python ä»£ç ç¤ºä¾‹

```python
from quant import QuantEventEngine, FusionAnalysisEngine

# 1. å¯åŠ¨äº‹ä»¶å¼•æ“
event_engine = QuantEventEngine()
event_engine.start()

# 2. åˆ›å»ºèåˆåˆ†æå¼•æ“
fusion_engine = FusionAnalysisEngine(event_engine)

# 3. æ‰§è¡Œèåˆåˆ†æ
result = fusion_engine.analyze_with_fusion(
    ohlcv_data=stock_data,  # OHLCV æ•°æ®
    market="CN",            # å¸‚åœºç±»å‹
    external_factors={      # å¯é€‰ï¼šå¤–éƒ¨å› ç´ 
        "news_sentiment": 65,
        "macro_indicators": 55
    }
)

# 4. æŸ¥çœ‹ç»“æœ
print(f"èåˆè¯„åˆ†: {result['fusion_score']}")
print(f"å»ºè®®æ“ä½œ: {result['final_advice']}")
print(f"é‡åŒ–ä¿¡å·: {result['quant_analysis']['signals']}")
print(f"å¸‚åœºæƒ…ç»ª: {result['info_analysis']['interpretation']}")

# 5. å…³é—­å¼•æ“
event_engine.stop()
```

### API é›†æˆç¤ºä¾‹

```python
from quant.integration import integrate_quant_with_existing_system

# é›†æˆåˆ°ç°æœ‰åˆ†ææµç¨‹
enhanced_result = integrate_quant_with_existing_system(
    stock_data=stock_data,
    stock_info=stock_info,
    indicators=indicators,
    trend=trend,
    levels=levels
)

# æå–å…³é”®æŒ‡æ ‡
metrics = enhanced_result['enhanced_metrics']
print(f"èåˆè¯„åˆ†: {metrics['fusion_score']}")
print(f"å¸‚åœºçŠ¶æ€: {metrics['market_status']['status']}")
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. EventEngine (äº‹ä»¶å¼•æ“)

å‚è€ƒ `vnpy.event.EventEngine`ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼š

```python
from quant import QuantEventEngine, Event

# åˆ›å»ºå¼•æ“
engine = QuantEventEngine()

# æ³¨å†Œäº‹ä»¶å¤„ç†
def on_signal(event):
    print(f"æ”¶åˆ°ä¿¡å·: {event.data}")

engine.register("eSignal", on_signal)

# å¯åŠ¨å¼•æ“
engine.start()

# å‘é€äº‹ä»¶
engine.emit("eSignal", {"score": 75, "action": "buy"})
```

### 2. ArrayManager (æ•°ç»„ç®¡ç†å™¨)

å‚è€ƒ `vnpy.trader.utility.ArrayManager`ï¼Œé«˜æ•ˆç®¡ç†æ—¶é—´åºåˆ—æ•°æ®ï¼š

```python
from quant import QuantArrayManager

am = QuantArrayManager(size=250)  # 250ä¸ªäº¤æ˜“æ—¥

# æ›´æ–°æ•°æ®
am.update_bar({
    "Open": 100.0,
    "High": 102.0,
    "Low": 99.0,
    "Close": 101.5,
    "Volume": 10000
})

# è®¡ç®—æŒ‡æ ‡
ma20 = am.sma(20)                # 20æ—¥å‡çº¿
rsi = am.rsi(14)                 # 14æ—¥RSI
dif, dea, macd = am.macd()       # MACD
upper, mid, lower = am.bollinger(20)  # å¸ƒæ—å¸¦
```

### 3. BarGenerator (Kçº¿ç”Ÿæˆå™¨)

å‚è€ƒ `vnpy.trader.utility.BarGenerator`ï¼Œç”¨äº Tick è½¬ K çº¿ï¼š

```python
from quant import BarGenerator

def on_bar(bar):
    print(f"ç”ŸæˆKçº¿: {bar}")

bg = BarGenerator(on_bar, window=5)  # 5åˆ†é’ŸKçº¿

# æ›´æ–°Tickæ•°æ®
bg.update_tick(tick_data)
```

---

## ğŸ“ˆ è¾“å‡ºæŠ¥å‘Šç¤ºä¾‹

### ç»¼åˆåˆ†ææŠ¥å‘Š

```markdown
## ğŸ¤– é‡åŒ–-AIè”åŠ¨åˆ†æå»ºè®®

**èåˆè¯„åˆ†**: 68.5/100 (ç½®ä¿¡åº¦: high)

**ç³»ç»Ÿå»ºè®®**: âœ… é‡åŒ–ä¿¡å·ä¸å¸‚åœºæƒ…ç»ªä¸€è‡´ï¼Œhighç½®ä¿¡åº¦ | ğŸ“Š å»ºè®®ï¼šé€‚åº¦å»ºä»“æˆ–åŠ ä»“ | ğŸŒ™ ç›˜åæ³¢åŠ¨å¾®å¼±ï¼Œç»Ÿè®¡å­¦ä¸æ˜¾è‘—

**ä¸€è‡´æ€§æ£€æŸ¥**: âœ… é‡åŒ–èåˆç³»ç»Ÿä¸åŸæœ‰åˆ†æä¸€è‡´

**æ“ä½œç­–ç•¥**: åŸºäºæƒ…ç»ª65.0åˆ†å’Œmediumæ³¢åŠ¨é¢„æœŸè°ƒæ•´
- å»ºè®®æ­¢æŸ: 5.0%
- å…¥åœºé˜ˆå€¼: 55.0
- ä»“ä½å»ºè®®: 0.8å€æ ‡å‡†ä»“ä½

**é‡åŒ–ä¿¡å·è¯¦æƒ…**:
- å‡çº¿å¤šå¤´æ’åˆ—
- ä»·æ ¼ç«™ä¸ŠMA20
- MACDé‡‘å‰ä¸”æŸ±çŠ¶å›¾ä¸ºæ­£
- RSIä¸­æ€§
- KDJé‡‘å‰

**å¸‚åœºæƒ…ç»ª**: å¸‚åœºæƒ…ç»ªåä¹è§‚ï¼Œè¶‹åŠ¿æ˜æ˜¾ï¼Œé¢„è®¡mediumæ³¢åŠ¨
```

---

## ğŸ”„ ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ

### æŠ¥å‘Šæ—¶é—´ä¿®å¤

**é—®é¢˜**: æŠ¥å‘Šæ˜¾ç¤º `2023å¹´10æœˆ15æ—¥`ï¼ˆé”™è¯¯ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ LLM prompt ä¸­æ˜ç¡®æ³¨å…¥å½“å‰æ—¶é—´
2. åå¤„ç†ä¸­å¼ºåˆ¶æ›¿æ¢æ‰€æœ‰æ—§æ—¥æœŸ
3. åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ æ˜ç¡®çš„æ—¶é—´æˆ³

```python
# ä¿®å¤åçš„æŠ¥å‘Šç»“å°¾
**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025å¹´12æœˆ16æ—¥ 20:54:32 | **æ•°æ®æ¥æº**: é‡åŒ–ç³»ç»Ÿ + AIå¤šæ™ºèƒ½ä½“åˆ†æ

*æœ¬æŠ¥å‘Šç”±é‡åŒ–å¼•æ“(åŸºäºvnpyæ¶æ„)ä¸AI Agentæ·±åº¦è”åŠ¨ç”Ÿæˆï¼Œæ•´åˆäº†ç¡¬æ•°æ®åˆ†æä¸è½¯åˆ¤æ–­è¯„ä¼°ã€‚*
```

### æ•°æ®è”åŠ¨

ç°æœ‰ç³»ç»Ÿ â†’ å¢å¼ºç³»ç»Ÿï¼š
- `stock_data` â†’ `QuantArrayManager` â†’ æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- `indicators` â†’ `Quant Agent` â†’ é‡åŒ–ä¿¡å·
- `trend` â†’ `Market Info Agent` â†’ æƒ…ç»ªåˆ†æ
- èåˆç»“æœ â†’ `FusionEngine` â†’ äº¤å‰éªŒè¯ â†’ æœ€ç»ˆå»ºè®®

---

## âš ï¸ å…è´£å£°æ˜

æœ¬ç³»ç»Ÿç”Ÿæˆçš„åˆ†ææŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚

---

## ğŸ“š å‚è€ƒèµ„æº

- **vnpy å®˜æ–¹ä»“åº“**: https://github.com/vnpy/vnpy
- **vnpy æ–‡æ¡£**: https://www.vnpy.com/docs/cn/
- **æ ¸å¿ƒç»„ä»¶å‚è€ƒ**:
  - `vnpy.event.EventEngine`
  - `vnpy.trader.utility.ArrayManager`
  - `vnpy.trader.utility.BarGenerator`
  - `vnpy.app.cta_strategy.StrategyTemplate`

---

**Made with â¤ï¸ by AI-Trade Quant Team**

**åŸºäº vnpy Master åˆ†æ”¯æ¶æ„ | 2025å¹´12æœˆ16æ—¥**
